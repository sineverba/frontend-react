version: v1.0

name: Deploy Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

global_job_config:
  secrets:
    - name: FRONTEND_REACT
    - name: NETLIFY

blocks:
  - name: Deploy
    task:
      jobs:
      - name: Deploy to Netlify
        commands:
          - checkout
          - npm install netlify-cli -g
          - npm ci
          - cp .env.bak .env
          - sed -i "s|1.2.3|$SEMAPHORE_JOB_ID|g" .env
          - cat .env
          - npm run build
          - netlify deploy -s $NETLIFY_SITE_ID --auth $NETLIFY_ACCESS_TOKEN -p --dir ./build